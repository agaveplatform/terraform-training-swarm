{"swagger":"2.0","info":{"version":"0.1.0","title":"Mock Agave Repositories API","description":"This is the API definition Agave's automated repository build service. The purpose of the service is to allow users to self-subscribe their public code repositories so that Agave can build their code into both Docker and Singularity containers and make the containers available for execution by the Jobs and Reactors APIs."},"tags":[{"name":"repositories","description":"Register code repositories for Agave to watch and autobuild into Docker and Singularity images that you can register as Apps and/or Reactors that run in response to events in the platform.","externalDocs":{"url":"https://github.com/agaveplatform/developer-docs/#Repositories"}}],"securityDefinitions":{"implicit":{"type":"oauth2","authorizationUrl":"http://example.com/oauth/auth","flow":"implicit","scopes":{"write":"allows modifying resources","read":"allows reading resources"}}},"security":[{"implicit":["read","write"]}],"definitions":{"ResponseModel":{"required":["status","version"],"properties":{"status":{"type":"string","enum":["success","error"],"description":"The response result. Always true"},"message":{"type":"string","description":"Optional message describing special circumstances of the request being satisfied"},"version":{"type":"string","description":"The current API version"}}},"ErrorResponseModel":{"required":["status","message","error","version"],"allOf":[{"$ref":"#/definitions/ResponseModel"},{"properties":{"error":{"$ref":"#/definitions/ErrorDetailsModel"}}}]},"FieldValidationErrorDetailModel":{"required":["fieldName"],"properties":{"fieldName":{"type":"string","description":"Name of the field failing validation"},"message":{"type":"string","description":"A message describing the nature of the field valiation error"}}},"ErrorDetailsModel":{"description":"Structured error response","required":["httpCode","apiCode","userMessage","developerMessage","validationErrors"],"properties":{"httpCode":{"type":"integer","format":"int32","description":"Optional must be a UUID so that is globally unique and searchable"},"apiCode":{"type":"integer","format":"int32","description":"Required and must be one of 200, 500, 400, 401, 403, 404"},"userMessage":{"type":"string","description":"An Error has occured and the request could not be completed"},"developerMessage":{"type":"string","description":"Invalid request body see validation errors"},"validationErrors":{"type":"array","items":{"$ref":"#/definitions/FieldValidationErrorDetailModel"}}}},"PaginatedResultModel":{"required":["total","perPage","currentPage","lastPage","nextPageUrl","prevPageUrl","from","to"],"properties":{"total":{"type":"integer","format":"int32","description":"Total number of results from the query"},"perPage":{"type":"integer","format":"int32","description":"Total number of results returned in this response"},"currentPage":{"type":"integer","format":"int32","description":"The current page of results returned in this request with respect to the total number of pages in the overall result set. A page is perPage results"},"lastPage":{"type":"integer","format":"int32","description":"The numeric index of the last page with respect to the number of pages in the overall result set."},"nextPageUrl":{"type":"string","description":"The url to the next page of results"},"prevPageUrl":{"type":"integer","format":"int32","description":"Total number of results from the query"},"from":{"type":"integer","format":"int32","description":"The index of the first result returned in this request with respect to the total number of overall results."},"to":{"type":"integer","format":"int32","description":"The index of the last result returned in this request with respect to the total number of overall results."}}},"PaginatedRepositoryResultModel":{"required":["total","perPage","currentPage","lastPage","nextPageUrl","prevPageUrl","from","to","data"],"allOf":[{"$ref":"#/definitions/PaginatedResultModel"},{"properties":{"data":{"description":"An array containing the actual response object from the query","type":"array","items":[{"$ref":"#/definitions/RepositoryModel"}]}}}]},"PaginatedRepositoryBuildResultModel":{"required":["total","perPage","currentPage","lastPage","nextPageUrl","prevPageUrl","from","to","data"],"allOf":[{"$ref":"#/definitions/PaginatedResultModel"},{"properties":{"data":{"description":"An array containing the actual response object from the query","type":"array","items":[{"$ref":"#/definitions/RepositoryBuildRequestModel"}]}}}]},"PaginatedRepositoryHistoryModel":{"required":["total","perPage","currentPage","lastPage","nextPageUrl","prevPageUrl","from","to","data"],"allOf":[{"$ref":"#/definitions/PaginatedResultModel"},{"properties":{"data":{"description":"An array containing the actual response object from the query","type":"array","items":[{"$ref":"#/definitions/RepositoryHistoryModel"}]}}}]},"RepositoryHistoryModel":{"required":["id","event","owner","description","created"],"properties":{"id":{"type":"string","description":"UUID of this history event"},"event":{"type":"string","description":"The event that triggered this history record"},"description":{"type":"string","description":"Human readable textual description of the event."},"owner":{"type":"string","description":"The subject that created this event."},"created":{"type":"string","description":"The timestamp when this event fired"}}},"PaginatedRepositoryResponseModel":{"required":["status","result","version"],"properties":{"status":{"type":"string","description":"The response result. Always true"},"message":{"type":"string","description":"Optional message describing special circumstances of the request being satisfied"},"result":{"description":"Array of resources listed or searched for by the request","type":"array","items":{"$ref":"#/definitions/PaginatedRepositoryResultModel"}},"version":{"type":"string","description":"The current API version"}}},"PaginatedRepositoryHistoryResponseModel":{"required":["status","result","version"],"properties":{"status":{"type":"string","description":"The response result. Always true"},"message":{"type":"string","description":"Optional message describing special circumstances of the request being satisfied"},"result":{"description":"Array of resources listed or searched for by the request","type":"array","items":{"$ref":"#/definitions/PaginatedRepositoryHistoryModel"}},"version":{"type":"string","description":"The current API version"}}},"PaginatedRepositoryBuildResponseModel":{"required":["status","result","version"],"properties":{"status":{"type":"string","description":"The response result. Always true"},"message":{"type":"string","description":"Optional message describing special circumstances of the request being satisfied"},"result":{"description":"Array of resources listed or searched for by the request","type":"array","items":{"$ref":"#/definitions/PaginatedRepositoryBuildResultModel"}},"version":{"type":"string","description":"The current API version"}}},"RepositoryBuildTagModel":{"properties":{"name":{"description":"Human readable name of the build tag","type":"string","example":"latest"},"sourceType":{"description":"Type of identifier on the source vcs repository to which the sourceName field refers","type":"string","enum":["branch","tag","commit","release"],"example":"branch"},"sourceName":{"description":"The name of the banch, tag, etc that Agave will check out and build","type":"string","example":"master"},"buildFilePath":{"description":"Relative path to the build file in the vcs repository","type":"string","example":"/Dockerfile"},"enabled":{"type":"boolean","description":"True if the build is enabled for this tag","example":true}}},"RepositoryTriggerModel":{"properties":{"url":{"type":"string","description":"URL to which a remote service can POST to and trigger a build","example":"https://api.agaveplatform.org/repositories/v2/nryan/pyplot/SOME_UUID"},"active":{"type":"boolean","description":"Whether the trigger is active","example":true},"token":{"type":"string","description":"An alphanumeric token the caller must include in the request header to properly fire this trigger","example":"kwherqwe89072o34ihq"}}},"RepositoryModel":{"properties":{"provider":{"type":"string","enum":["git","github","bitbucket","gitlab"],"description":"The service provider where the repository resides","example":"github"},"vcs_url":{"type":"string","description":"The url to the repository. May be relative path if the provider is github or bitbucket provider.","example":"https://github.com/deardooley/FUNWAVE-TVD"},"enabled":{"type":"boolean","description":"True if the repository is enabled for building, or disabled and effectively inactive.","example":true},"autobuild":{"type":"boolean","description":"True if the repository should be built upon change detection","example":true}}},"RepositoryBuildRequestModel":{"properties":{"builds":{"type":"array","items":{"$ref":"#/definitions/RepositoryBuildTagModel"},"description":"The  that will trigger builds","example":["${BUILD_HASH}","${BRANCH_NAME}"]},"provider":{"type":"string","enum":["git","github","bitbucket","gitlab"],"description":"The service provider where the repository resides","example":"github"},"url":{"type":"string","description":"The url to the repository. May be relative path if the provider is github or bitbucket provider.","example":"https://github.com/deardooley/FUNWAVE-TVD"},"path":{"type":"string","description":"The path, relative to the repository root, of the build file. The repository will be built out of the parent directory","example":"/Dockerfile"},"branch":{"type":"array","items":{"type":"string"},"description":"The branch that will tigger builds","example":["master","release"]}}},"RepositoryRequestModel":{"allOf":[{"$ref":"#/definitions/RepositoryModel"}],"required":["provider","url","path","branch","tags","autobuild","enabled"]},"RepositoryResponseModel":{"description":"Full repository details response from the API","allOf":[{"$ref":"#/definitions/ResponseModel"},{"properties":{"result":{"$ref":"#/definitions/RepositoryModel"}}}]},"RepositoryBuildResponseModel":{"description":"Repository build details response from the API","allOf":[{"$ref":"#/definitions/ResponseModel"},{"properties":{"result":{"type":"object"}}}]},"RepositoryBuildLogResponseModel":{"description":"Repository build log response from the API","allOf":[{"$ref":"#/definitions/ResponseModel"},{"properties":{"result":{"type":"object"}}}]}},"paths":{"/repositories":{"get":{"summary":"List registered repositories","description":"Lists all repositories registered by the user","tags":["repositories"],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/PaginatedRepositoryResponseModel"}}}},"post":{"summary":"Registers a new git repository for auto-builds","description":"Register a new repository","tags":["repositories"],"consumes":["application/json"],"parameters":[{"name":"fileToUpload","in":"body","schema":{"$ref":"#/definitions/RepositoryModel"}}],"responses":{"201":{"description":"Created","schema":{"$ref":"#/definitions/RepositoryResponseModel"}}}}},"/repositories/{id}":{"get":{"summary":"Get repository by id","description":"Fetches repository info by id","tags":["repositories"],"parameters":[{"in":"path","name":"id","type":"string","required":true,"description":"ID of the respoitory"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/RepositoryResponseModel"}}}},"put":{"summary":"Updates an existing repository","description":"Update a repository","tags":["repositories"],"consumes":["application/json"],"parameters":[{"name":"fileToUpload","in":"body","schema":{"$ref":"#/definitions/RepositoryModel"}}],"responses":{"200":{"description":"Updated","schema":{"$ref":"#/definitions/RepositoryResponseModel"}}}},"patch":{"summary":"Partially updates an existing repository","description":"Partially update a repository","tags":["repositories"],"consumes":["application/json"],"parameters":[{"name":"patch","in":"body","description":"The fields to update in an existing repository object","schema":{"$ref":"#/definitions/RepositoryModel"}}],"responses":{"200":{"description":"Updated","schema":{"$ref":"#/definitions/RepositoryResponseModel"}}}},"delete":{"summary":"Deletes an existing repository","description":"Delete a repository","tags":["repositories"],"consumes":["application/json"],"responses":{"200":{"description":"Deleted","schema":{"$ref":"#/definitions/ResponseModel"}}}}},"/repositories/{id}/builds":{"get":{"summary":"Get repository by id","description":"Fetches repository info by id","tags":["repositories"],"parameters":[{"in":"path","name":"id","type":"string","required":true,"description":"ID of the respoitory"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/PaginatedRepositoryBuildResponseModel"}}}},"post":{"summary":"Force a new build to run","description":"Manually trigger a new build of the repository. Note that calling this successively may result in buids being queued up. In that situation, redundant builds requests will be ignored if no code changes have been made between the last build and the current request.","tags":["repositories"],"consumes":["application/json"],"parameters":[{"in":"path","name":"id","type":"string","required":true,"description":"ID of the respoitory"}],"responses":{"200":{"description":"Updated","schema":{"$ref":"#/definitions/RepositoryBuildResponseModel"}}}},"delete":{"summary":"Clear build history","description":"Delete build history","tags":["repositories"],"consumes":["application/json"],"responses":{"200":{"description":"Deleted","schema":{"$ref":"#/definitions/ResponseModel"}}}}},"/repositories/{id}/builds/{buildId}":{"get":{"summary":"Get repository build by id","description":"Fetches repository info by id","tags":["repositories"],"parameters":[{"in":"path","name":"id","type":"string","required":true,"description":"ID of the respoitory"},{"in":"path","name":"buildId","type":"string","required":true,"description":"ID of the respoitory build"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/RepositoryBuildResponseModel"}}}},"delete":{"summary":"Delete a build","description":"Delete a build. If the build is currently running, it will be stopped, then deleted. This will remove the logs as well.","tags":["repositories"],"consumes":["application/json"],"parameters":[{"in":"path","name":"id","type":"string","required":true,"description":"ID of the respoitory"},{"in":"path","name":"buildId","type":"string","required":true,"description":"ID of the respoitory build"}],"responses":{"200":{"description":"Deleted","schema":{"$ref":"#/definitions/ResponseModel"}}}}},"/repositories/{id}/builds/{buildId}/log":{"get":{"summary":"Fetch the build log output for this build","description":"Fetches log output of this build. Range requests are supported","tags":["repositories"],"parameters":[{"in":"path","name":"id","type":"string","required":true,"description":"ID of the respoitory"},{"in":"path","name":"buildId","type":"string","required":true,"description":"ID of the respoitory build"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/RepositoryBuildLogResponseModel"}}}}},"/repositories/{id}/history":{"get":{"summary":"List repository history","description":"Get or query the history of events on this repository","tags":["repositories"],"parameters":[{"in":"path","name":"id","type":"string","required":true,"description":"ID of the respoitory"}],"responses":{"200":{"description":"OK","schema":{"$ref":"#/definitions/PaginatedRepositoryHistoryResponseModel"}}}}}},"host":"virtserver.swaggerhub.com","basePath":"/deardooley/Repositories/1.0.0","schemes":["https"]}